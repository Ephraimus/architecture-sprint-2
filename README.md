# Инструкция по развертыванию pymongo-api с MongoDB шардированием и репликацией

## ## Задание 1. Планирование
[Схема](./sprint2.drawio)

## Описание проекта

В проекте `pymongo-api` реализован API для взаимодействия с MongoDB, поддерживающий горизонтальное масштабирование данных за счет использования шардирования и репликации. Это позволяет проекту эффективно обрабатывать большие объемы данных и распределять нагрузку между серверами базы данных.

### Файлы и каталоги проекта

Проект состоит из следующих подкаталогов:

- `base`: базовая версия проекта с одной MongoDB базой данных.
- `mongo-sharding`: версия проекта, в которой MongoDB развернута с двумя шардированными узлами для распределения данных.
- `mongo-sharding-repl`: расширение проекта с двумя шардированными узлами, каждый из которых поддерживает три реплики для обеспечения отказоустойчивости.
- `sharding-repl-cache`: финальная версия с шардированием, репликацией (по три реплики на каждый шард) и использованием Redis для кэширования запросов, что снижает нагрузку на базу данных и ускоряет обработку часто запрашиваемых данных.

> **Важно:**  Рекомендуется использовать такие инструменты, как **Postman** или аналогичные для работы с API.

## Подготовка к запуску

### Шаг 1: Выбор конфигурации

Перейдите в директорию `sharding-repl-cache`, если вы хотите запустить полную конфигурацию проекта с шардированием, репликацией и кэшированием. 

```shell
cd sharding-repl-cache
```

### Шаг 2: Запуск сервисов с Docker Compose
Запустите все сервисы, включая MongoDB, pymongo-api и Redis, выполнив следующую команду:
```shell
docker compose up -d
```
Эта команда поднимет все контейнеры в фоновом режиме, включая два шардированных узла MongoDB, по три реплики на каждый шард, конфигурационный сервер, маршрутизатор mongos, приложение pymongo-api и Redis для кэширования.

### Шаг 3: Инициализация шардирования и репликации
После того как все сервисы будут запущены, необходимо настроить конфигурацию шардирования, репликации и заполнить базу данных тестовыми данными. Для этого выполните скрипт инициализации:
```shell
./scripts/mongo-init.sh
```
Этот скрипт выполняет следующие задачи:

1. Настраивает конфигурационный сервер для хранения информации о шардах.
1. Инициализирует репликационные наборы для каждого шарда.
1. Подключает шарды к маршрутизатору mongos.
1. Включает шардирование для базы данных somedb.
1. Устанавливает ключ шардирования для коллекции helloDoc.

Далее:
```shell
./scripts/add-data.sh
```
1. Заполняет коллекцию helloDoc тестовыми данными.

### Шаг 4: Проверка успешного запуска
После выполнения инициализации можно проверить работу API. Для этого откройте документацию Swagger, доступную по адресу http://localhost:8080/docs, или используйте Postman для отправки запросов к API.
